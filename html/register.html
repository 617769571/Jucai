<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<link href="../css/mui.min.css" rel="stylesheet"/>
    	<link href="../css/base.css" rel="stylesheet"/>
    	<link href="../css/login.css" rel="stylesheet"/>
	</head>
	<body>
		<header id="header" class="mui-bar mui-bar-nav">
			<h1 class="mui-title">注册</h1>
		</header>
		<div class="mui-content">
			<div class="banner">每周口袋</div>
			<div class="float_box">
				<div class="item">
					<div class="fl">
						<img src="../images/imgs/phone.png"/>
					</div>
					<input type="number" id="telephone" placeholder="请输入手机号"/>
				</div>
				<div class="item">
					<div class="fl">
						<img src="../images/imgs/password.png"/>
					</div>
					<input type="text" id="password" placeholder="请输入密码"/>
				</div>
				<div class="item" style="display: flex;flex-wrap: nowrap;align-content: center;align-items: center;justify-content: space-between;padding: 0;height: 56px;">
					<input type="text" id="code" placeholder="请输入验证码" style="margin: 0;"/>
					<button type="button" class="yanzhengma">发送验证码</button>
				</div>
				<div id="submit">注册</div>
				<div class="other_opt">
					已有账号？<span id="login">立即登录</span>
				</div>
			</div>
		</div>
		
		<script src="../js/jquery-3.3.1.min.js"></script>
		<script src="../js/mui.min.js"></script>
		<script src="../js/util.js"></script>
		<script src="../js/base.js"></script>
		<script type="text/javascript" charset="utf-8">
			(function() {
				mui.init({
					keyEventBind: {
						backbutton: false  //关闭back按键监听
					}
				});
				mui.plusReady(function() {
					var times = 60;
					function roof(){
						if(times == 0){
							$('.yanzhengma').text('发送验证码('+times+'s)');
							$('.yanzhengma').prop('disabled',false);
							$('.yanzhengma').text('发送验证码');
							times = 60;
							return
						}
						$('.yanzhengma').text('发送验证码('+times+'s)');
						times--;

						setTimeout(roof,1000);
					}
					
					mui('body').on('tap', '.yanzhengma', function() {
						if(!$('#telephone').val() || !REG.CellPhone($('#telephone').val())){
							mui.alert('请输入正确格式的手机号', '温馨提示', function() {});
							return;
						}
						$('.yanzhengma').prop('disabled',true);
						roof();
						POST({ 
							url: "/sendCode", 
							data: {
								telephone: $('#telephone').val()
							},
							success: function(res){
								if(res.code){									
								}
							}
						});
					})

					mui('body').on('tap', '#submit', function() {
						if(!$('#telephone').val() || !REG.CellPhone($('#telephone').val())){
							mui.alert('请输入正确格式的手机号', '温馨提示', function() {});
							return;
						}
						if(!$('#password').val()){
							mui.alert('请输入密码', '温馨提示', function() {});
							return;
						}
						if(!$('#code').val()){
							mui.alert('请输入验证码', '温馨提示', function() {});
							return;
						}
						POST({ 
							url: "/insertUser",
							data: {
								username: $('#telephone').val(),
								password: $('#password').val(),
								code:$('#code').val()
							},
							success: function(res){
								console.log(JSON.stringify(res))
								if(res.code==0){
									mui.alert('注册成功', function() {});
									mui.back();
// 									plus.storage.setItem('userInfo', JSON.stringify({
// 										id: 0,
// 										username: $('#telephone').val()
// 									}))
// 									plus.webview.getLaunchWebview().show();
// 									plus.webview.getLaunchWebview().reload();
								}else{
									mui.alert(res.data, function() {});

								}
								
							}
						});
					})
				});
				// 跳转登录
				mui('body').on('tap', '#login', function() {
					mui.openWindow('login.html', 'login');
				});
			})();
		</script>
	</body>
</html>
